{
  "hash": "32f513064e9bba7c54dd227c325a67fa",
  "result": {
    "markdown": "---\ntitle: \"Visualizing priors\"\nsubtitle: \"<br/>With great power comes great responsibility: Stan for modern ecological modelling\"\nauthor: \"Andrew MacDonald\"\ndate: \"2023-05-03\"\noutput:\n  xaringan::moon_reader:\n    lib_dir: libs\n    nature:\n      highlightStyle: github\n      highlightLines: true\n      countIncrementalSlides: false\n---\n\n\n\n\n# Bayesian models\n\n$$\n\\begin{align}\nF_i & \\sim \\text{Poisson}(\\lambda_i) \\\\\n\\text{log}(\\lambda_i) &= \\alpha + \\beta x \\\\\n\\alpha & \\sim \\text{Normal}(??, ??) \\\\\n\\beta & \\sim \\text{Normal}(??, ??)\n\\end{align}\n$$\n\n---\n\n# Bayesian models\n\n$$\n\\begin{align}\nF_i & \\sim \\text{Poisson}(\\lambda_i) \\\\\n\\text{log}(\\lambda_i) &= \\alpha + \\beta x \\\\\n\\alpha & \\sim \\text{Normal}(0, 1000) \\\\\n\\beta & \\sim \\text{Normal}(0, 1000)\n\\end{align}\n$$\n\n.footnote[as seen in Kéry & Royle 2016 p 188]\n\n\n---\nclass: inverse, center, middle\n\n# So what _is_ a good prior?\n\n---\n\n\n![](img/gabry_et_al_fig.png)\n\n.footnote[\nGabry, Jonah, Daniel Simpson, Aki Vehtari, Michael Betancourt, and Andrew Gelman. « Visualization in Bayesian Workflow ». Journal of the Royal Statistical Society: Series A (Statistics in Society) 182 (2): 389‑402. https://doi.org/10.1111/rssa.12378.\n]\n\n\n---\n\n# what does this prior mean?\n\n$$\n\\begin{align}\nF_i & \\sim \\text{Poisson}(\\lambda_i) \\\\\n\\text{log}(\\lambda_i) &= \\alpha + \\beta x \\\\\n\\alpha & \\sim \\text{Normal}(0, 1000) \\\\\n\\beta & \\sim \\text{Normal}(0, 1000)\n\\end{align}\n$$\n\n---\n\n# what does this prior mean?\n\nlets do an example about my favourites: fly larvae! \n\n.pull-left[\n<img src=\"img/lil_larv.png\" style=\"width: 70%\" />\n]\n\n.pull-right[\n$$\n\\begin{align}\nF_i & \\sim \\text{Poisson}(\\lambda_i) \\\\\n\\text{log}(\\lambda_i) &= \\alpha + \\beta x \\\\\n\\alpha & \\sim \\text{Normal}(0, 1000) \\\\\n\\beta & \\sim \\text{Normal}(0, 1000)\n\\end{align}\n$$\nwhere $x$ is some kind of standardized environmental variable\n]\n\n---\n\n# A quick look at the math for those curious\n\n$$\n\\begin{align}\n\\text{log}(\\lambda) &= \\alpha + \\beta x \\\\\n\\lambda &= e^{\\alpha + \\beta x} \\\\\n\\lambda &= e^{\\alpha}e^{\\beta x} \\\\\n\\end{align}\n$$\n\nAnd since $N(0,1000)$ implies that -1000 and +1000 are entirely reasonable..\n\n.pull-left[\n* $2.72^{-1000}\\times 2.72^{-1000}$\n* (practically zero)\n]\n\n.pull-right[\n* $2.72^{1000}\\times 2.72^{1000}$\n* (..kind of a lot)\n]\n\n---\n\n# either no flies at all.. or a huge planet of maggots \n\n<img src=\"img/many_insects.png\" style=\"width: 70%\" />\n\nfor comparison, the planet Saturn weighs 5.7 * 10^29 grams\n\n---\n\n# syntax: brms\n\n```r\n# define formula\n\ninsects_bf <- bf(\nabundance ~ 1 + env, \nfamily = poisson()\n)\n```\n\n---\n\n# syntax: setting priors\n\n```r\nget_prior(insects_bf, data = insect_data)\n\ninsect_priors <- c(\n  prior(normal(0,100), class = \"b\", coef = \"env\"),\n  prior(normal(0,100), class = \"Intercept\")\n)\n```\n\n---\n\n# syntax: sampling the model\n\n```r\ninsect_samples <- brm(insects_bf,\n                      data = insect_data,  # does nothing\n                      prior = insect_priors,\n                      sample_prior = \"only\")\n```\n\n---\n\n# Exercise I -- Fly larvae\n\n* see the file `insects.R` on [github](https://github.com/aammd/ISEC_stan_course/blob/996eb5b2f49c52b0290c63a6635f925104bb623b/insects.R)\n\n* on your own or in a small group, experiment with setting priors for insect abundances.\n* AND/OR consider an animal or plant which is more relevant to you \n* or stay with insects even if that is not your specialty, and set \"vague\" priors!\n\n---\n\n# exercises -- les poissons\n\nusing data from [Kaggle, about fish](https://www.kaggle.com/aungpyaeap/fish-market)\n\n\n\n```{.r .cell-code}\nlibrary(readr)\nfish <- read_csv(\"https://raw.githubusercontent.com/aammd/ISEC_stan_course/master/Fish.csv\")\n\nknitr::kable(head(fish), format = 'html')\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Species </th>\n   <th style=\"text-align:right;\"> Weight </th>\n   <th style=\"text-align:right;\"> Length1 </th>\n   <th style=\"text-align:right;\"> Length2 </th>\n   <th style=\"text-align:right;\"> Length3 </th>\n   <th style=\"text-align:right;\"> Height </th>\n   <th style=\"text-align:right;\"> Width </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Bream </td>\n   <td style=\"text-align:right;\"> 242 </td>\n   <td style=\"text-align:right;\"> 23.2 </td>\n   <td style=\"text-align:right;\"> 25.4 </td>\n   <td style=\"text-align:right;\"> 30.0 </td>\n   <td style=\"text-align:right;\"> 11.5200 </td>\n   <td style=\"text-align:right;\"> 4.0200 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Bream </td>\n   <td style=\"text-align:right;\"> 290 </td>\n   <td style=\"text-align:right;\"> 24.0 </td>\n   <td style=\"text-align:right;\"> 26.3 </td>\n   <td style=\"text-align:right;\"> 31.2 </td>\n   <td style=\"text-align:right;\"> 12.4800 </td>\n   <td style=\"text-align:right;\"> 4.3056 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Bream </td>\n   <td style=\"text-align:right;\"> 340 </td>\n   <td style=\"text-align:right;\"> 23.9 </td>\n   <td style=\"text-align:right;\"> 26.5 </td>\n   <td style=\"text-align:right;\"> 31.1 </td>\n   <td style=\"text-align:right;\"> 12.3778 </td>\n   <td style=\"text-align:right;\"> 4.6961 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Bream </td>\n   <td style=\"text-align:right;\"> 363 </td>\n   <td style=\"text-align:right;\"> 26.3 </td>\n   <td style=\"text-align:right;\"> 29.0 </td>\n   <td style=\"text-align:right;\"> 33.5 </td>\n   <td style=\"text-align:right;\"> 12.7300 </td>\n   <td style=\"text-align:right;\"> 4.4555 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Bream </td>\n   <td style=\"text-align:right;\"> 430 </td>\n   <td style=\"text-align:right;\"> 26.5 </td>\n   <td style=\"text-align:right;\"> 29.0 </td>\n   <td style=\"text-align:right;\"> 34.0 </td>\n   <td style=\"text-align:right;\"> 12.4440 </td>\n   <td style=\"text-align:right;\"> 5.1340 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Bream </td>\n   <td style=\"text-align:right;\"> 450 </td>\n   <td style=\"text-align:right;\"> 26.8 </td>\n   <td style=\"text-align:right;\"> 29.7 </td>\n   <td style=\"text-align:right;\"> 34.7 </td>\n   <td style=\"text-align:right;\"> 13.6024 </td>\n   <td style=\"text-align:right;\"> 4.9274 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n\n---\n\n![](img/fish.png)\n\n---\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}